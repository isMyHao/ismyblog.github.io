{"title":"云攻防-K8S搭建","uid":"057dca3af5aa739fb2629cb762787844","slug":"云攻防-k8s搭建","date":"2025-05-17T09:03:45.056Z","updated":"2025-05-17T12:43:05.883Z","comments":true,"path":"api/articles/云攻防-k8s搭建.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/07d4681d-b7f1-4d6f-b718-c01399944150.jpg","content":"<h1 id=\"云攻防-k8s手动搭建\"><a href=\"#云攻防-k8s手动搭建\" class=\"headerlink\" title=\"云攻防-k8s手动搭建\"></a>云攻防-k8s手动搭建</h1><p>国内网络环境 优化的 CentOS 7 部署 Kubernetes 集群详细步骤,及常见问题</p>\n<h2 id=\"一、环境准备（所有节点执行）\"><a href=\"#一、环境准备（所有节点执行）\" class=\"headerlink\" title=\"一、环境准备（所有节点执行）\"></a>一、环境准备（所有节点执行）</h2><h3 id=\"1-配置主机名与-hosts-解析\"><a href=\"#1-配置主机名与-hosts-解析\" class=\"headerlink\" title=\"1. 配置主机名与 hosts 解析\"></a>1. 配置主机名与 hosts 解析</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># Master 节点</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">hostnamectl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">set-hostname</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">k8s-master</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># Worker 节点（如 node1）</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">hostnamectl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">set-hostname</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">k8s-node1</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># 所有节点编辑 /etc/hosts</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">cat</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&lt;&lt;</span><span style=\"color: #F6F6F4\">EOF</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&gt;&gt;</span><span style=\"color: #F6F6F4\"> /etc/hosts</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">&lt;Master节点内网IP&gt; k8s-master</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">&lt;Worker节点内网IP&gt; k8s-node1</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">EOF</span></span></code></pre></div><h3 id=\"2-关闭防火墙、SELinux-和-Swap\"><a href=\"#2-关闭防火墙、SELinux-和-Swap\" class=\"headerlink\" title=\"2. 关闭防火墙、SELinux 和 Swap\"></a>2. 关闭防火墙、SELinux 和 Swap</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">stop</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">firewalld</span><span style=\"color: #F6F6F4\"> &amp;&amp; </span><span style=\"color: #62E884\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">disable</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">firewalld</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">setenforce</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">0</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sed</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-i</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #DEE492\">&#39;</span><span style=\"color: #E7EE98\">s/^SELINUX=enforcing$/SELINUX=permissive/</span><span style=\"color: #DEE492\">&#39;</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/etc/selinux/config</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">swapoff</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-a</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sed</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-i</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #DEE492\">&#39;</span><span style=\"color: #E7EE98\">/ swap / s/^\\(.*\\)$/#\\1/g</span><span style=\"color: #DEE492\">&#39;</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/etc/fstab</span><span style=\"color: #F6F6F4\">  </span><span style=\"color: #7B7F8B\"># 永久关闭 Swap</span></span></code></pre></div><h3 id=\"3-配置内核参数\"><a href=\"#3-配置内核参数\" class=\"headerlink\" title=\"3. 配置内核参数\"></a>3. 配置内核参数</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">cat</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&lt;&lt;</span><span style=\"color: #F6F6F4\">EOF</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&gt;</span><span style=\"color: #F6F6F4\"> /etc/sysctl.d/k8s.conf</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">net.bridge.bridge-nf-call-ip6tables = 1</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">net.bridge.bridge-nf-call-iptables = 1</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">net.ipv4.ip_forward = 1</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">EOF</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sysctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">--system</span></span></code></pre></div><h3 id=\"4-加载内核模块\"><a href=\"#4-加载内核模块\" class=\"headerlink\" title=\"4. 加载内核模块\"></a>4. 加载内核模块</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">modprobe</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">br_netfilter</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">modprobe</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">overlay</span></span></code></pre></div><h2 id=\"二、安装容器运行时（所有节点执行）\"><a href=\"#二、安装容器运行时（所有节点执行）\" class=\"headerlink\" title=\"二、安装容器运行时（所有节点执行）\"></a>二、安装容器运行时（所有节点执行）</h2><p>CentOS 7 yum 无法使用</p>\n<p>CentOS 7 仓库已经被归档，当前的镜像地址无法找到所需的文件。CentOS 7 的官方支持已经结束，部分仓库已被移至归档库。这导致了 yum 命令无法找到所需的元数据文件。CentOS 7 的官方仓库在 2024 年 6 月 30 日之后已经停止维护。因此，使用最新的 CentOS 7 官方仓库可能会遇到问题。</p>\n<p>参考文章：</p>\n<p><a href=\"https://blog.csdn.net/weixin_68792404/article/details/147272888\">https://blog.csdn.net/weixin_68792404/article/details/147272888</a></p>\n<p>解决方法:</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #97E1F1\">cd</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/etc/yum.repos.d</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">cp</span><span style=\"color: #F6F6F4\">  </span><span style=\"color: #E7EE98\">CentOS-Base.repo</span><span style=\"color: #F6F6F4\">   </span><span style=\"color: #E7EE98\">CentOS-Base.repo.backup</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">vi</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">CentOS-Base.repo</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">修改内容</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># CentOS-Base.repo</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># The mirror system uses the connecting IP address of the client and the</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># update status of each mirror to pick mirrors that are updated to and</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># geographically close to the client.  You should use this for CentOS updates</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># unless you are manually picking other mirrors.</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># If the mirrorlist= does not work for you, as a fall back you can try the </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># remarked out baseurl= line instead.</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">[base]</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">name</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">CentOS-</span><span style=\"color: #BF9EEE\">$releasever</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #62E884\">-</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">Base</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#baseurl=http://vault.centos.org/7.9.2009/x86_64/os/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">baseurl</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">http://vault.centos.org/7.9.2009/os/</span><span style=\"color: #BF9EEE\">$basearch</span><span style=\"color: #E7EE98\">/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgcheck</span><span style=\"color: #F286C4\">=</span><span style=\"color: #BF9EEE\">1</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgkey</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#released updates </span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">[updates]</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">name</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">CentOS-</span><span style=\"color: #BF9EEE\">$releasever</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #62E884\">-</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">Updates</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#baseurl=http://vault.centos.org/7.9.2009/x86_64/os/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">baseurl</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">http://vault.centos.org/7.9.2009/updates/</span><span style=\"color: #BF9EEE\">$basearch</span><span style=\"color: #E7EE98\">/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgcheck</span><span style=\"color: #F286C4\">=</span><span style=\"color: #BF9EEE\">1</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgkey</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#additional packages that may be useful</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">[extras]</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">name</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">CentOS-</span><span style=\"color: #BF9EEE\">$releasever</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #62E884\">-</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">Extras</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#$baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#baseurl=http://vault.centos.org/7.9.2009/x86_64/os/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">baseurl</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">http://vault.centos.org/7.9.2009/extras/</span><span style=\"color: #BF9EEE\">$basearch</span><span style=\"color: #E7EE98\">/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgcheck</span><span style=\"color: #F286C4\">=</span><span style=\"color: #BF9EEE\">1</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgkey</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#additional packages that extend functionality of existing packages</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">[centosplus]</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">name</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">CentOS-</span><span style=\"color: #BF9EEE\">$releasever</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #62E884\">-</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">Plus</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=centosplus&amp;infra=$infra</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#baseurl=http://mirror.centos.org/centos/$releasever/centosplus/$basearch/</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#baseurl=http://vault.centos.org/7.9.2009/x86_64/os/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">baseurl</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">http://vault.centos.org/7.9.2009/centosplus/</span><span style=\"color: #BF9EEE\">$basearch</span><span style=\"color: #E7EE98\">/</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgcheck</span><span style=\"color: #F286C4\">=</span><span style=\"color: #BF9EEE\">1</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">enabled</span><span style=\"color: #F286C4\">=</span><span style=\"color: #BF9EEE\">0</span></span>\n<span class=\"line\"><span style=\"color: #BF9EEE\">gpgkey</span><span style=\"color: #F286C4\">=</span><span style=\"color: #E7EE98\">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span></code></pre></div><p>保存后执行</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">yum</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">clean</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">all</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">yum</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">makecache</span></span></code></pre></div><p>然后执行以下命令</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">curl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-o</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/etc/yum.repos.d/CentOS-Base.repo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">https://mirrors.aliyun.com/repo/Centos-7.repo</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">yum</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">clean</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">all</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">yum</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">makecache</span></span></code></pre></div><h3 id=\"1-安装-Docker（国内镜像加速）\"><a href=\"#1-安装-Docker（国内镜像加速）\" class=\"headerlink\" title=\"1. 安装 Docker（国内镜像加速）\"></a>1. 安装 Docker（国内镜像加速）</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 使用阿里云 Docker 仓库</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">yum</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">install</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-y</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">yum-utils</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">yum-config-manager</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">--add-repo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span></code></pre></div><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 安装指定版本 Docker</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">yum</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">install</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-y</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">docker-ce-20.10.23</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">docker-ce-cli-20.10.23</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">containerd.io</span></span></code></pre></div><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 配置 Docker 镜像加速和 cgroup 驱动</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">mkdir</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-p</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/etc/docker</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">cat</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&lt;&lt;</span><span style=\"color: #F6F6F4\">EOF</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&gt;</span><span style=\"color: #F6F6F4\"> /etc/docker/daemon.json</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">  &quot;registry-mirrors&quot;: [&quot;https://&lt;你的阿里云镜像加速地址&gt;.mirror.aliyuncs.com&quot;],</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">  &quot;log-driver&quot;: &quot;json-file&quot;,</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">  &quot;log-opts&quot;: &#123;&quot;max-size&quot;: &quot;100m&quot;&#125;,</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">  &quot;storage-driver&quot;: &quot;overlay2&quot;</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">EOF</span></span></code></pre></div><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 启动 Docker</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">enable</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">docker</span><span style=\"color: #F6F6F4\"> &amp;&amp; </span><span style=\"color: #62E884\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">start</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">docker</span></span></code></pre></div><h2 id=\"三、安装-Kubernetes-组件（所有节点执行）\"><a href=\"#三、安装-Kubernetes-组件（所有节点执行）\" class=\"headerlink\" title=\"三、安装 Kubernetes 组件（所有节点执行）\"></a>三、安装 Kubernetes 组件（所有节点执行）</h2><h3 id=\"1-配置阿里云-Kubernetes-仓库\"><a href=\"#1-配置阿里云-Kubernetes-仓库\" class=\"headerlink\" title=\"1. 配置阿里云 Kubernetes 仓库\"></a>1. 配置阿里云 Kubernetes 仓库</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">cat</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&lt;&lt;</span><span style=\"color: #F6F6F4\">EOF</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&gt;</span><span style=\"color: #F6F6F4\"> /etc/yum.repos.d/kubernetes.repo</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">[kubernetes]</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">name=Kubernetes</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">enabled=1</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">gpgcheck=0</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">repo_gpgcheck=0</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">EOF</span></span></code></pre></div><h3 id=\"2-安装-kubeadm、kubelet、kubectl\"><a href=\"#2-安装-kubeadm、kubelet、kubectl\" class=\"headerlink\" title=\"2. 安装 kubeadm、kubelet、kubectl\"></a>2. 安装 kubeadm、kubelet、kubectl</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 指定版本安装（示例版本 1.28.2）</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">yum</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">install</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-y</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">kubelet-1.28.2</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">kubeadm-1.28.2</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">kubectl-1.28.2</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">--disableexcludes=kubernetes</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># 启动 kubelet</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">enable</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">kubelet</span><span style=\"color: #F6F6F4\"> &amp;&amp; </span><span style=\"color: #62E884\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">start</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">kubelet</span></span></code></pre></div><h2 id=\"四、初始化-Master-节点\"><a href=\"#四、初始化-Master-节点\" class=\"headerlink\" title=\"四、初始化 Master 节点\"></a>四、初始化 Master 节点</h2><p>安装网络插件:</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\">#Flannel</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">kubectl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">apply</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-f</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">kubectl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">get</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">pods</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-n</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">kube-system</span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\">#Calico</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">curl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-O</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">https://raw.githubusercontent.com/projectcalico/calico/v3.27.0/manifests/calico.yaml</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sed</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-i</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #DEE492\">&#39;</span><span style=\"color: #E7EE98\">s#docker.io/calico/#registry.cn-hangzhou.aliyuncs.com/calico_community/#g</span><span style=\"color: #DEE492\">&#39;</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">calico.yaml</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">kubectl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">apply</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-f</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">calico.yaml</span></span></code></pre></div><p>Kubernetes 从 1.24 版本开始已移除对 Docker 的直接支持，必须通过 cri-dockerd 适配器实现兼容。</p>\n<p>安装 cri-dockerd 适配器（所有节点安装）</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 下载最新版 cri-dockerd</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">wget</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.7/cri-dockerd-0.3.7.amd64.tgz</span></span></code></pre></div><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 解压并安装</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">tar</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">xvf</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">cri-dockerd-0.3.7.amd64.tgz</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">mv</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">cri-dockerd/cri-dockerd</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/usr/local/bin/</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">chmod</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">+x</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/usr/local/bin/cri-dockerd</span></span></code></pre></div><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F6F6F4\"> </span></span>\n<span class=\"line\"><span style=\"color: #7B7F8B\"># 创建 systemd 服务文件</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">cat</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&lt;&lt;</span><span style=\"color: #F6F6F4\">EOF</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">|</span><span style=\"color: #F6F6F4\"> sudo tee /usr/lib/systemd/system/cri-docker.service</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">[Unit]</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">Description=CRI Interface for Docker</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">After=network.target docker.service</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">Requires=docker.service</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\"> </span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">[Service]</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">ExecStart=/usr/local/bin/cri-dockerd --container-runtime-endpoint unix:///var/run/cri-dockerd.sock</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">Restart=on-failure</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\"> </span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">[Install]</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">WantedBy=multi-user.target</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">EOF</span></span></code></pre></div><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7B7F8B\"># 启动服务</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">daemon-reload</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">enable</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">cri-docker</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">systemctl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">start</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">cri-docker</span></span></code></pre></div><p><strong>配置 kubelet 使用 Docker</strong></p>\n<p>创建 kubelet 配置文件</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">mkdir</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-p</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/etc/systemd/system/kubelet.service.d</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">cat</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">&lt;&lt;</span><span style=\"color: #F6F6F4\">EOF</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">|</span><span style=\"color: #F6F6F4\"> sudo tee /etc/systemd/system/kubelet.service.d/0-cri-docker.conf</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">[Service]</span></span>\n<span class=\"line\"><span style=\"color: #E7EE98\">Environment=&quot;KUBELET_EXTRA_ARGS=--container-runtime=remote --container-runtime-endpoint=unix:///var/run/cri-dockerd.sock&quot;</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">EOF</span></span></code></pre></div><p><strong>初始化 master 节点</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">kubeadm</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">init</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">\\</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">  </span><span style=\"color: #BF9EEE\">--image-repository</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">registry.aliyuncs.com/google_containers</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">\\</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">  </span><span style=\"color: #BF9EEE\">--apiserver-advertise-address</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">内网master的ip</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">\\</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">  </span><span style=\"color: #BF9EEE\">--pod-network-cidr=10.244.0.0/16</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">\\ </span><span style=\"color: #F6F6F4\">       </span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">  </span><span style=\"color: #62E884\">--token-ttl</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">0</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">\\</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">  </span><span style=\"color: #BF9EEE\">--cri-socket</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">unix:///var/run/cri-dockerd.sock</span><span style=\"color: #F6F6F4\">  </span><span style=\"color: #7B7F8B\"># 关键参数！</span></span></code></pre></div><p>成功后会输出以下命令，保存供 Worker 节点加入：</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">mkdir</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-p</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">$HOME</span><span style=\"color: #E7EE98\">/.kube</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">cp</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">-i</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">/etc/kubernetes/admin.conf</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">$HOME</span><span style=\"color: #E7EE98\">/.kube/config</span></span>\n<span class=\"line\"><span style=\"color: #62E884\">sudo</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">chown</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">$(</span><span style=\"color: #62E884\">id</span><span style=\"color: #E7EE98\"> </span><span style=\"color: #BF9EEE\">-u</span><span style=\"color: #E7EE98\">):$(</span><span style=\"color: #62E884\">id</span><span style=\"color: #E7EE98\"> </span><span style=\"color: #BF9EEE\">-g</span><span style=\"color: #E7EE98\">)</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">$HOME</span><span style=\"color: #E7EE98\">/.kube/config</span></span></code></pre></div><p>node 加入集群 这里加入集群的命令每个人都不一样，可以登录 master 节点，使用 kubeadm token create –print-join-command 来获取。获取后在 node 主机下执行</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki dracula-soft\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #62E884\">kubeadm</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">join</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">master节点ip:6443</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #BF9EEE\">--token</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">s1dthx.saz58vfk2vjaxqcj</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #F286C4\">\\</span></span>\n<span class=\"line\"><span style=\"color: #F6F6F4\">    </span><span style=\"color: #BF9EEE\">--discovery-token-ca-cert-hash</span><span style=\"color: #F6F6F4\"> </span><span style=\"color: #E7EE98\">sha256:6304e0c416ab6ab41f5de0aad71428c68099900063526f509c364237fe120051</span><span style=\"color: #F6F6F4\"> </span></span></code></pre></div><p>验证集群</p>\n<p>kubectl get nodes</p>\n<p>kubectl get pods -n kube-system</p>\n<p>如果存在master节点显示Ready了,但node节点是noready，说明了clicoa的网卡没有就绪，需要拉镜像</p>\n<p>实在没办法，咸鱼20块钱搞定</p>\n","text":"云攻防-k8s手动搭建国内网络环境 优化的 CentOS 7 部署 Kubernetes 集群详细步骤,及常见问题 一、环境准备（所有节点执行）1. 配置主机名...","permalink":"/post/云攻防-k8s搭建","photos":[],"count_time":{"symbolsCount":"7.2k","symbolsTime":"7 mins."},"categories":[{"name":"云安全","slug":"云安全","count":3,"path":"api/categories/云安全.json"}],"tags":[{"name":"云安全","slug":"云安全","count":3,"path":"api/tags/云安全.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%91%E6%94%BB%E9%98%B2-k8s%E6%89%8B%E5%8A%A8%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">云攻防-k8s手动搭建</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C%EF%BC%89\"><span class=\"toc-text\">一、环境准备（所有节点执行）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D%E4%B8%8E-hosts-%E8%A7%A3%E6%9E%90\"><span class=\"toc-text\">1. 配置主机名与 hosts 解析</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E3%80%81SELinux-%E5%92%8C-Swap\"><span class=\"toc-text\">2. 关闭防火墙、SELinux 和 Swap</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E9%85%8D%E7%BD%AE%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">3. 配置内核参数</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-%E5%8A%A0%E8%BD%BD%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97\"><span class=\"toc-text\">4. 加载内核模块</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C%EF%BC%89\"><span class=\"toc-text\">二、安装容器运行时（所有节点执行）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E5%AE%89%E8%A3%85-Docker%EF%BC%88%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%EF%BC%89\"><span class=\"toc-text\">1. 安装 Docker（国内镜像加速）</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85-Kubernetes-%E7%BB%84%E4%BB%B6%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C%EF%BC%89\"><span class=\"toc-text\">三、安装 Kubernetes 组件（所有节点执行）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E9%85%8D%E7%BD%AE%E9%98%BF%E9%87%8C%E4%BA%91-Kubernetes-%E4%BB%93%E5%BA%93\"><span class=\"toc-text\">1. 配置阿里云 Kubernetes 仓库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E5%AE%89%E8%A3%85-kubeadm%E3%80%81kubelet%E3%80%81kubectl\"><span class=\"toc-text\">2. 安装 kubeadm、kubelet、kubectl</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9B%9B%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96-Master-%E8%8A%82%E7%82%B9\"><span class=\"toc-text\">四、初始化 Master 节点</span></a></li></ol></li></ol>","author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Java安全学习路径","uid":"7c3e14f0681c54989a322aaf4933843e","slug":"Java安全学习路线","date":"2025-05-17T07:27:11.184Z","updated":"2025-05-17T09:15:50.655Z","comments":true,"path":"api/articles/Java安全学习路线.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/%23chudia%20%23anime%20%23wataa%20%23girl%20%23wlw.jpg","text":"参考文章： https://github.com/HackJava/HackJava ","permalink":"/post/Java安全学习路线","photos":[],"count_time":{"symbolsCount":43,"symbolsTime":"1 mins."},"categories":[{"name":"Java安全","slug":"Java安全","count":4,"path":"api/categories/Java安全.json"}],"tags":[{"name":"Java安全","slug":"Java安全","count":4,"path":"api/tags/Java安全.json"}],"author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"云攻防-自动化工具CDK","uid":"2d7ab8d810fa55a7f8f329a080d4b514","slug":"云攻防-自动化工具CDK","date":"2025-05-17T09:01:52.604Z","updated":"2025-05-17T09:03:14.960Z","comments":true,"path":"api/articles/云攻防-自动化工具CDK.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/03b0866b33895d638a5ad57f0285f8f7.jpg","text":"云攻防-自动化工具CDKhttps://github.com/cdk-team/CDK 概述 CDK 是一个开源的容器渗透工具包，旨在提供对各种精简容器的稳定利...","permalink":"/post/云攻防-自动化工具CDK","photos":[],"count_time":{"symbolsCount":147,"symbolsTime":"1 mins."},"categories":[{"name":"tools","slug":"tools","count":1,"path":"api/categories/tools.json"}],"tags":[{"name":"tools","slug":"tools","count":1,"path":"api/tags/tools.json"}],"author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}}}}